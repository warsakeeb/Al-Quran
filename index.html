<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>QuranConnect</title>
  
  <!-- NEW PERMANENT EMBEDDED ICONS (No external links) -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#10b981">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%2310b981'/%3E%3Cpath d='M150 210 C190 180 230 190 256 210 C282 190 322 180 362 210 V360 C322 330 282 340 256 360 C230 340 190 330 150 360 Z' fill='none' stroke='%23ffffff' stroke-width='32' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M256 210 V360' fill='none' stroke='%23ffffff' stroke-width='32' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='115' fill='%2310b981'/%3E%3Cpath d='M150 210 C190 180 230 190 256 210 C282 190 322 180 362 210 V360 C322 330 282 340 256 360 C230 340 190 330 150 360 Z' fill='none' stroke='%23ffffff' stroke-width='32' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M256 210 V360' fill='none' stroke='%23ffffff' stroke-width='32' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
  
  <!-- React and Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Inter:wght@400;500;600;700;800&display=swap');
    
    :root {
      --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #ecfdf5 50%, #f0f9ff 100%);
      --card-bg: #ffffff;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --primary: #10b981;
      --primary-light: #d1fae5;
      --primary-dark: #047857;
      --border: rgba(16, 185, 129, 0.15);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      --shadow-hover: 0 10px 30px rgba(16, 185, 129, 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg-gradient);
      color: var(--text-main); 
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }

    .font-arabic { font-family: 'Amiri Quran', serif; line-height: 2.2; }

    .app-container { max-width: 800px; margin: 0 auto; padding: 20px; padding-top: 30px; }
    
    .flex-row { display: flex; align-items: center; }
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .flex-col { display: flex; flex-direction: column; }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    
    .fade-in { animation: fadeInUp 0.6s ease forwards; }
    
    .nav-bar { margin-bottom: 40px; }
    .logo-icon {
      background: linear-gradient(135deg, #34d399, #10b981);
      width: 44px; height: 44px; border-radius: 14px;
      display: flex; justify-content: center; align-items: center;
      color: white; box-shadow: 0 4px 12px rgba(16,185,129,0.3);
      margin-right: 12px;
    }
    .nav-title { font-size: 24px; font-weight: 800; color: var(--text-main); }
    .nav-title span { font-weight: 400; color: var(--primary); }
    .badge-offline {
      background: var(--primary-light); color: var(--primary-dark);
      font-size: 12px; font-weight: 600; padding: 6px 12px;
      border-radius: 20px; display: flex; align-items: center; gap: 4px;
    }

    .hero { text-align: center; margin-bottom: 30px; }
    .hero h2 { font-size: 32px; font-weight: 800; color: #064e3b; margin-bottom: 10px; }
    .hero p { color: var(--text-muted); font-size: 16px; max-width: 400px; margin: 0 auto; line-height: 1.5; }

    .search-container { position: relative; margin-bottom: 40px; }
    .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; }
    .search-input {
      width: 100%; padding: 18px 20px 18px 48px;
      border-radius: 20px; border: 1px solid #e2e8f0;
      font-size: 16px; outline: none; background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.02); transition: all 0.3s ease;
    }
    .search-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-light); }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; padding-bottom: 40px; }

    .card {
      background: var(--card-bg); border-radius: 20px; padding: 20px;
      border: 1px solid var(--border); box-shadow: var(--shadow);
      transition: all 0.3s ease; cursor: pointer; text-align: left;
      appearance: none; -webkit-appearance: none; display: block; width: 100%;
    }
    .card:hover, .card:active { transform: translateY(-3px); box-shadow: var(--shadow-hover); border-color: #6ee7b7; }
    
    .surah-num {
      width: 44px; height: 44px; border-radius: 12px;
      background: var(--primary-light); color: var(--primary-dark);
      font-weight: 700; font-size: 16px; flex-shrink: 0; margin-right: 16px;
      display: flex; justify-content: center; align-items: center;
    }
    
    .surah-title { font-size: 16px; font-weight: 700; color: var(--text-main); margin-bottom: 4px; }
    .surah-arabic { font-size: 20px; color: var(--primary-dark); }
    .surah-trans { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;}
    .surah-meta { font-size: 11px; font-weight: 600; color: #0284c7; background: #e0f2fe; padding: 4px 8px; border-radius: 6px; display: inline-block;}

    .sticky-header {
      position: sticky; top: 10px; z-index: 50;
      background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
      padding: 16px; border-radius: 20px; border: 1px solid var(--border);
      box-shadow: var(--shadow); margin-bottom: 30px;
    }
    .back-btn {
      background: #f1f5f9; border: none; padding: 10px 16px; border-radius: 12px;
      font-weight: 600; color: var(--text-main); cursor: pointer; display: flex; gap: 8px;
    }
    
    .bismillah { text-align: center; font-size: 36px; color: #064e3b; margin: 40px 0; padding: 20px 0; border-bottom: 1px solid var(--border); }

    .ayah-card { background: white; border-radius: 24px; padding: 24px; margin-bottom: 24px; border: 1px solid var(--border); box-shadow: var(--shadow); }
    .ayah-header { margin-bottom: 24px; }
    .ayah-num { width: 40px; height: 40px; border-radius: 50%; background: var(--primary-light); color: var(--primary-dark); font-weight: bold; display: flex; justify-content: center; align-items: center;}
    .share-btn { background: transparent; border: none; color: #94a3b8; cursor: pointer; padding: 8px; border-radius: 50%; transition: 0.2s;}
    .share-btn:hover { background: #f1f5f9; color: var(--primary); }
    
    .ayah-arabic { font-size: 32px; color: #022c22; text-align: right; margin-bottom: 24px; direction: rtl; }
    .ayah-english { font-size: 18px; color: #334155; line-height: 1.7; }

    .loader-container { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 0; }
    .spinner { width: 40px; height: 40px; border: 4px solid var(--primary-light); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px; }

    .notif-banner {
      position: fixed; top: 16px; left: 16px; right: 16px; z-index: 999;
      background: rgba(255,255,255,0.95); backdrop-filter: blur(12px);
      padding: 20px; border-radius: 24px; border: 1px solid rgba(16,185,129,0.3);
      box-shadow: 0 15px 40px rgba(0,0,0,0.1); animation: slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      max-width: 600px; margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('Service Worker Registered'))
          .catch(err => console.log('Service Worker Error', err));
      });
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const Icons = {
      Book: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>,
      Search: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
      Chevron: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
      Bell: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
      Share: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>,
      Sparkles: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg>
    };

    const CACHE_KEY = 'quran_vanilla_v2_';
    const fetchWithCache = async (key, url) => {
      try {
        const cached = localStorage.getItem(CACHE_KEY + key);
        if (cached) return JSON.parse(cached);
      } catch (e) {}

      const res = await fetch(url);
      const data = await res.json();
      try { localStorage.setItem(CACHE_KEY + key, JSON.stringify(data)); } catch (e) {}
      return data;
    };

    const copyToClipboard = (text) => {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      try { document.execCommand('copy'); alert("Verse Copied!"); } catch (err) {}
      document.body.removeChild(textArea);
    };

    const DAILY_AYAHS = ['2:255', '2:286', '3:190', '13:28', '20:46', '24:35', '94:5', '94:6'];

    function App() {
      const [view, setView] = useState('home');
      const [surahs, setSurahs] = useState([]);
      const [currentSurah, setCurrentSurah] = useState(null);
      const [surahData, setSurahData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [searchQuery, setSearchQuery] = useState('');
      
      const [dailyAyah, setDailyAyah] = useState(null);
      const [showNotif, setShowNotif] = useState(false);

      useEffect(() => {
        loadSurahList();
        loadDailyAyah();
      }, []);

      const loadSurahList = async () => {
        setLoading(true);
        const data = await fetchWithCache('surahs', 'https://api.alquran.cloud/v1/surah');
        setSurahs(data.data);
        setLoading(false);
      };

      const loadDailyAyah = async () => {
        const today = new Date().toISOString().split('T')[0];
        const day = new Date().getDate();
        const ref = DAILY_AYAHS[day % DAILY_AYAHS.length];
        
        try {
          const data = await fetchWithCache('daily_'+today, `https://api.alquran.cloud/v1/ayah/${ref}/editions/quran-uthmani,en.sahih`);
          setDailyAyah({
            ar: data.data[0].text, en: data.data[1].text, 
            name: data.data[0].surah.englishName, num: data.data[0].numberInSurah,
            surah: data.data[0].surah
          });
          
          if (localStorage.getItem('quran_last_notif') !== today) {
            setTimeout(() => setShowNotif(true), 1500);
          }
        } catch(e) {}
      };

      const openSurah = async (surah) => {
        setView('surah'); setCurrentSurah(surah); setSurahData(null); setLoading(true);
        window.scrollTo(0, 0);

        const [arRes, enRes] = await Promise.all([
          fetchWithCache('ar_'+surah.number, `https://api.alquran.cloud/v1/surah/${surah.number}/quran-uthmani`),
          fetchWithCache('en_'+surah.number, `https://api.alquran.cloud/v1/surah/${surah.number}/en.sahih`)
        ]);

        const ayahs = arRes.data.ayahs.map((a, i) => {
          let text = a.text;
          if (surah.number !== 1 && surah.number !== 9 && a.numberInSurah === 1) {
             text = text.replace("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ ", "").replace("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ", "");
          }
          return { num: a.numberInSurah, ar: text, en: enRes.data.ayahs[i].text };
        });

        setSurahData(ayahs); setLoading(false);
      };

      const filtered = useMemo(() => {
        return surahs.filter(s => s.englishName.toLowerCase().includes(searchQuery.toLowerCase()) || s.number.toString() === searchQuery);
      }, [surahs, searchQuery]);

      return (
        <div className="app-container">
          
          {showNotif && dailyAyah && (
            <div className="notif-banner">
              <div className="flex-between" style={{marginBottom: '12px'}}>
                <div className="flex-row" style={{color: 'var(--primary-dark)', fontWeight: 'bold', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '1px'}}>
                  <span style={{marginRight: '6px'}}><Icons.Bell /></span> Daily Reminder
                </div>
                <button onClick={() => { setShowNotif(false); localStorage.setItem('quran_last_notif', new Date().toISOString().split('T')[0]); }} style={{background: 'none', border: 'none', color: '#94a3b8', cursor: 'pointer'}}>
                  <Icons.X />
                </button>
              </div>
              <div className="font-arabic" style={{textAlign: 'right', fontSize: '24px', color: '#022c22', marginBottom: '12px', direction: 'rtl'}}>{dailyAyah.ar}</div>
              <div style={{fontSize: '14px', color: '#475569', lineHeight: '1.6', marginBottom: '16px'}}>"{dailyAyah.en}"</div>
              
              <div className="flex-between">
                <span style={{fontSize: '12px', fontWeight: 'bold', color: '#94a3b8'}}>{dailyAyah.name} ({dailyAyah.num})</span>
                <button onClick={() => { setShowNotif(false); openSurah(dailyAyah.surah); }} style={{background: 'var(--primary-light)', color: 'var(--primary-dark)', border: 'none', padding: '6px 14px', borderRadius: '20px', fontWeight: 'bold', cursor: 'pointer', fontSize: '12px'}}>
                  Read Surah
                </button>
              </div>
            </div>
          )}

          <div className="nav-bar flex-between fade-in">
            <div className="flex-row cursor-pointer" onClick={() => setView('home')}>
              <div className="logo-icon"><Icons.Book /></div>
              <div className="nav-title">Quran<span>Connect</span></div>
            </div>
            <div className="badge-offline"><Icons.Sparkles /> Offline</div>
          </div>

          {view === 'home' && (
            <div className="fade-in">
              <div className="hero">
                <h2>Peaceful Guidance.</h2>
                <p>Read the Holy Quran with a beautifully clean, distraction-free interface.</p>
              </div>

              <div className="search-container">
                <div className="search-icon"><Icons.Search /></div>
                <input 
                  type="text" 
                  className="search-input" 
                  placeholder="Search Surahs by name or number..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
              </div>

              {loading ? (
                <div className="loader-container">
                  <div className="spinner"></div>
                  <p style={{color: 'var(--primary)', fontWeight: 'bold'}}>Loading Library...</p>
                </div>
              ) : (
                <div className="grid">
                  {filtered.map(s => (
                    <button key={s.number} className="card flex-row" onClick={() => openSurah(s)}>
                      <div className="surah-num">{s.number}</div>
                      <div style={{flex: 1}}>
                        <div className="flex-between">
                          <div className="surah-title">{s.englishName}</div>
                          <div className="surah-arabic font-arabic">{s.name.replace('سُورَةُ ', '')}</div>
                        </div>
                        <div className="surah-trans">{s.englishNameTranslation}</div>
                        <div>
                          <span className="surah-meta">{s.revelationType} • {s.numberOfAyahs} Verses</span>
                        </div>
                      </div>
                    </button>
                  ))}
                  {filtered.length === 0 && (
                    <div style={{gridColumn: '1 / -1', textAlign: 'center', padding: '40px', color: 'var(--text-muted)'}}>
                      No Surahs found matching "{searchQuery}"
                    </div>
                  )}
                </div>
              )}
            </div>
          )}

          {view === 'surah' && currentSurah && (
            <div className="fade-in">
              <div className="sticky-header flex-between">
                <button className="back-btn" onClick={() => setView('home')}>
                  <Icons.Chevron /> Index
                </button>
                <div style={{textAlign: 'center'}}>
                  <div style={{fontSize: '18px', fontWeight: 'bold', color: 'var(--text-main)'}}>{currentSurah.englishName}</div>
                  <div style={{fontSize: '10px', fontWeight: 'bold', color: 'var(--primary)', textTransform: 'uppercase', letterSpacing: '1px', marginTop: '4px'}}>{currentSurah.englishNameTranslation}</div>
                </div>
                <div className="font-arabic" style={{fontSize: '20px', color: 'var(--primary-dark)', width: '60px', textAlign: 'right'}}>{currentSurah.name.replace('سُورَةُ ', '')}</div>
              </div>

              {loading ? (
                <div className="loader-container">
                  <div className="spinner"></div>
                  <p style={{color: 'var(--primary)', fontWeight: 'bold'}}>Retrieving Verses...</p>
                </div>
              ) : (
                <div>
                  {currentSurah.number !== 1 && currentSurah.number !== 9 && (
                    <div className="bismillah font-arabic">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>
                  )}

                  {surahData.map(ayah => (
                    <div key={ayah.num} className="ayah-card">
                      <div className="ayah-header flex-between">
                        <div className="ayah-num">{ayah.num}</div>
                        <button className="share-btn" onClick={() => copyToClipboard(ayah.en + " - Quran " + ayah.num)}>
                          <Icons.Share />
                        </button>
                      </div>
                      <div className="ayah-arabic font-arabic">{ayah.ar}</div>
                      <div className="ayah-english">{ayah.en}</div>
                    </div>
                  ))}

                  <div style={{textAlign: 'center', padding: '40px', color: '#cbd5e1', fontWeight: 'bold', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '2px'}}>
                    End of {currentSurah.englishName}
                  </div>
                </div>
              )}
            </div>
          )}

        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>


